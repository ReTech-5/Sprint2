<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../style/global.css">
    <link rel="stylesheet" href="../style/navbar.css">
    <link rel="stylesheet" href="../style/dashboardSensor.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Document</title>
</head>
<body>
    
    <!-- Inicio da Navbar -->

    <header class="navbar">
        <div class="container_nav">
            
            <div id="logo_nav">
                <a href=""><img src="../asset/img/Logo.svg" alt=""></a>
            </div>

            <nav class="nav">
                
                <ul class="ul_nav">

                    <li><a href="">Landing Page</a></li>
                    <li><a id="page_atual" href="">Dashboard</a></li>
                    <li><a href="">Calculadora</a></li>
                    <li><a href="">Contato</a></li>
                    <li><a href="">Configura√ß√µes</a></li>

                </ul>

                <div class="user">

                    <a href=""><img src="../asset/img/Avatar.svg" alt=""></a>
                    <span id="msg_user"></span>

                </div>

            </nav>
            
        </div>
    </header>

    <!-- Fim da Navbar -->

    <!-- Inicio tela de Dashboard dos Sensores -->

    <section class="dashboard_sensor">

        <h1>Grupo: Av. Lins de Vasconcelos</h1>

        <ul>

            <h4>Categoria: <span>???</span></h4>
            <h4>Sensor: <span>???</span></h4>
            <li class="sensor">
                <div id="container_flex">
                    <div class="container rosquinha">
                        
                        <canvas id="cvs_roscaReciclavel"></canvas>

                    </div>

                    <div class="container_kpi">
                        
                        <div class="title_kpi"><span>Pico Preenchi.</span> <a href=""><img src="../asset/img/InfoIcon.png" alt=""></a></div>
                        <div class="container kpi">
                            
                            <span>20:00</span>

                        </div>
                        
                        <div class="title_kpi meio"><span>Hor√°rio Pico</span> <a href=""><img src="../asset/img/InfoIcon.png" alt=""></a></div>
                        <div class="container kpi meio conteudo_kpi">

                            <span>17:00</span>

                        </div>

                        <div class="title_kpi meio"><span>Preenchi. M√©dio</span> <a href=""><img src="../asset/img/InfoIcon.png" alt=""></a></div>
                        <div class="container kpi meio conteudo_kpi">

                            <span>38%</span>

                        </div>

                        <div class="title_kpi"> <span>Temp. M√©dio</span> <a href=""><img src="../asset/img/InfoIcon.png" alt=""></a></div>
                        <div class="container kpi">

                            <span>8 Horas</span>

                        </div>

                    </div>
                
                </div>

                <div class="container linha">

                    <canvas id="cvs_linhaReciclavel"></canvas>

                </div>

            </li>

            <h4>Categoria: <span>???</span></h4>
            <h4>Sensor: <span>???</span></h4>
            <li class="sensor">
                <div id="container_flex">
                    <div class="container rosquinha">
                        
                        <canvas id="cvs_roscaOrganico"></canvas>

                    </div>

                    <div class="container_kpi">
                        
                        <div class="title_kpi"><span>Pico Preenchi.</span> <a href=""><img src="../asset/img/InfoIcon.png" alt=""></a></div>
                        <div class="container kpi">
                            
                            <span>20:00</span>

                        </div>
                        
                        <div class="title_kpi meio"><span>Hor√°rio Pico</span> <a href=""><img src="../asset/img/InfoIcon.png" alt=""></a></div>
                        <div class="container kpi meio conteudo_kpi">

                            <span>17:00</span>

                        </div>

                        <div class="title_kpi meio"><span>Preenchi. M√©dio</span> <a href=""><img src="../asset/img/InfoIcon.png" alt=""></a></div>
                        <div class="container kpi meio conteudo_kpi">

                            <span>38%</span>

                        </div>

                        <div class="title_kpi"> <span>Temp. M√©dio</span> <a href=""><img src="../asset/img/InfoIcon.png" alt=""></a></div>
                        <div class="container kpi">

                            <span>8 Horas</span>

                        </div>

                    </div>
                
                </div>

                <div class="container linha">

                    <canvas id="cvs_linhaOrganico"></canvas>

                </div>

            </li>
            
        </ul>    

    </section>

    <!-- Fim da tela de Dashboar dos Sensores -->


</body>
</html>

<script>

    // Mensagem para o usuario na navbar
    var usuario = 'Gleison'

    msg_user.innerHTML = `Ol√° ${usuario} üëã`

    // Pega o elemento <canvas> do DOM pelo ID e guarda em uma constante para usar com o Chart.js.
    const LinhaReciclavel = document.getElementById("cvs_linhaReciclavel");
    const LinhaOrganico = document.getElementById("cvs_linhaOrganico");
    const RoscaReciclavel = document.getElementById("cvs_roscaReciclavel");
    const RoscaOrganico = document.getElementById("cvs_roscaOrganico");
    var ultimo1 = 80;
    var ultimo2 = 74;
    var cor1 = "";
    var cor2 = "";
    
    // Gr√°fico de Linha da Curva de Preenchimento de uma Lixeira Recicl√°vel
    /* Cria uma nova inst√¢ncia de Chart no canvas LinhaReciclavel
    "new Chart(elemento, config)" √© a forma padr√£o de inicializar um gr√°fico com Chart.js */
    new Chart(LinhaReciclavel, {
        type: "line", // Tipo do gr√°fico: "line" (linha)
        data: { // Objeto que cont√©m os dados e r√≥tulos do gr√°fico
            labels: ["10:00", "10:30", "11:00", "11:30", "12:00", "12:30", "13:00", "13:30", "14:00", "14:30", "15:00", "15:30", "16:00", "16:30", "17:00", "17:30", "18:00", "18:30", "19:00", "19:30", "20:00"],
            // "labels" define os r√≥tulos do eixo X (cada valor do dataset corresponde a um label na mesma posi√ß√£o)
            datasets: [{ // Vetor de conjuntos de dados. Mesmo que seja apenas 1 dataset, precisa ser um vetor
                label: "N√≠vel de Preenchimento", // Nome do dataset ‚Äî aparece na legenda
                data: [2, 5, 5, 6, 15, 25, 28, 33, 40, 40, 42, 42, 43, 55, 62, 68, 70, 72, 72, 75, ultimo1], // Valores num√©ricos do dataset (nesta ordem correspondem aos labels acima)
                fill: false, // Indica se a √°rea abaixo da linha deve ser preenchida
                borderColor: "rgb(16, 183, 127)", // Cor da linha
                tension: 0.2 // Curvatura da linha: 0 = reta entre pontos, valores maiores = curvas mais suaves
            }]
        },
        options: { // Configura√ß√µes e op√ß√µes do gr√°fico (layout, plugins, escalas, interatividade, etc.)
            responsive: true, // Faz o gr√°fico redimensionar automaticamente com o container
            plugins: { // Configura√ß√µes para plugins nativos (legend, title, tooltip, etc.)
                legend: { display: true }, // Mostra a legenda (nome do dataset)
                title: { 
                    display: true, 
                    text: "Curva de Preenchimento - Recicl√°vel",
                    color: "black",
                    font: {size: 15, weight: "bold", family: "Arial"},
                }, // T√≠tulo do gr√°fico
                tooltip: { // Personaliza o conte√∫do do tooltip (o bal√£o que aparece ao passar o mouse)
                    callbacks: {
                        label: function(context) { // "label" recebe o contexto do ponto e retorna a string que aparecer√° no tooltip
                            return context.dataset.label + ": " + context.parsed.y + "%";
                            // context.dataset.label = nome do dataset
                            // context.parsed.y = valor do ponto no eixo y (para gr√°fico de linha)
                        }
                    }
                }
            },
            scales: { // Configura√ß√£o das escalas (eixos x e y)
                y: { // Configura√ß√£o do eixo Y
                    beginAtZero: true, // Faz com que o eixo comece em zero
                    max: 100, // Define o limite m√°ximo como 100%
                    ticks: { // Personaliza os ticks (r√≥tulos) do eixo
                        callback: function(value) { // Fun√ß√£o chamada para renderizar cada tick no eixo
                            return value + "%"; // Adiciona o s√≠mbolo '%' aos r√≥tulos do eixo Y
                        }
                    },
                    title: { // T√≠tulo do eixo Y
                        display: true,
                        text: "Ocupa√ß√£o (%)",
                        color: "rgb(4, 32, 13)",
                        font: { size: 15, weight: "bold" }
                    }
                },
                x: {
                    title: { // T√≠tulo do eixo X
                        display: true,
                        text: "Hor√°rio",
                        color: "rgb(4, 32, 13)",
                        font: { size: 15, weight: "bold" }
                    }
                }
            }
        }
    });
    
    // Gr√°fico de Linha da Curva de Preenchimento de uma Lixeira Org√¢nica
    /* Cria uma nova inst√¢ncia de Chart no canvas LinhaOrganico
    "new Chart(elemento, config)" √© a forma padr√£o de inicializar um gr√°fico com Chart.js */
    new Chart(LinhaOrganico, {
        type: "line", // Tipo do gr√°fico: "line" (linha)
        data: { // Objeto que cont√©m os dados e r√≥tulos do gr√°fico
            labels: ["10:00", "10:30", "11:00", "11:30", "12:00", "12:30", "13:00", "13:30", "14:00", "14:30", "15:00", "15:30", "16:00", "16:30", "17:00", "17:30", "18:00", "18:30", "19:00", "19:30", "20:00"],
            // "labels" define os r√≥tulos do eixo X (cada valor do dataset corresponde a um label na mesma posi√ß√£o)
            datasets: [{ // Vetor de conjuntos de dados. Mesmo que seja apenas 1 dataset, precisa ser um vetor
                label: "N√≠vel de Preenchimento", // Nome do dataset ‚Äî aparece na legenda
                data: [2, 5, 5, 6, 15, 17, 20, 24, 28, 33, 39, 42, 43, 50, 56, 60, 64, 69, 70, 71, ultimo2], // Valores num√©ricos do dataset (nesta ordem correspondem aos labels acima)
                fill: false, // Indica se a √°rea abaixo da linha deve ser preenchida
                borderColor: "rgb(16, 183, 127)", // Cor da linha
                tension: 0.2 // Curvatura da linha: 0 = reta entre pontos, valores maiores = curvas mais suaves
            }]
        },
        options: { // Configura√ß√µes e op√ß√µes do gr√°fico (layout, plugins, escalas, interatividade, etc.)
            responsive: true, // Faz o gr√°fico redimensionar automaticamente com o container
            plugins: { // Configura√ß√µes para plugins nativos (legend, title, tooltip, etc.)
                legend: { display: true }, // Mostra a legenda (nome do dataset)
                title: { 
                    display: true, text: "Curva de Preenchimento - Org√¢nico",
                    color: "black",
                    font: {size: 15, weight: "bold", family: "Arial"},
                }, // T√≠tulo do gr√°fico
                tooltip: { // Personaliza o conte√∫do do tooltip (o bal√£o que aparece ao passar o mouse)
                    callbacks: {
                        label: function(context) { // "label" recebe o contexto do ponto e retorna a string que aparecer√° no tooltip
                            return context.dataset.label + ": " + context.parsed.y + "%";
                            // context.dataset.label = nome do dataset
                            // context.parsed.y = valor do ponto no eixo y (para gr√°fico de linha)
                        }
                    }
                }
            },
            scales: { // Configura√ß√£o das escalas (eixos x e y)
                y: { // Configura√ß√£o do eixo Y
                    beginAtZero: true, // Faz com que o eixo comece em zero
                    max: 100, // Define o limite m√°ximo como 100%
                    ticks: { // Personaliza os ticks (r√≥tulos) do eixo
                        callback: function(value) { // Fun√ß√£o chamada para renderizar cada tick no eixo
                            return value + "%"; // Adiciona o s√≠mbolo '%' aos r√≥tulos do eixo Y
                        }
                    },
                    title: { // T√≠tulo do eixo Y
                        display: true,
                        text: "Ocupa√ß√£o (%)",
                        color: "rgb(4, 32, 13)",
                        font: { size: 15, weight: "bold" }
                    }
                },
                x: {
                    title: { // T√≠tulo do eixo X
                        display: true,
                        text: "Hor√°rio",
                        color: "rgb(4, 32, 13)",
                        font: { size: 15, weight: "bold" }
                    }
                }
            }
        }
    });
    
    // Valida√ß√µes para alterar a cor dos gr√°ficos de rosca dinamicamente
    if (ultimo1 >= 0 && ultimo1 <= 25) {
        cor1 = "rgb(29, 209, 9)";
    }
    else if (ultimo1 >= 26 && ultimo1 <= 50) {
        cor1 = "rgb(209, 206, 9)";
    }
    else if (ultimo1 >= 51 && ultimo1 <= 75) {
        cor1 = "rgb(209, 132, 9)";
    }
    else {
        cor1 = "rgb(209, 9, 9)";
    }
    if (ultimo2 >= 0 && ultimo2 <= 25) {
        cor2 = "rgb(29, 209, 9)";
    }
    else if (ultimo2 >= 26 && ultimo2 <= 50) {
        cor2 = "rgb(209, 206, 9)";
    }
    else if (ultimo2 >= 51 && ultimo2 <= 75) {
        cor2 = "rgb(209, 132, 9)";
    }
    else {
        cor2 = "rgb(209, 9, 9)";
    }
    
    // Plugin para exibir texto central dentro da rosca
    const centerTextPlugin = { // Declara um objeto que ser√° o plugin
        id: "centerText",  // Identificador √∫nico do plugin (usado internamente pelo Chart.js)
        afterDraw(chart) { // Hook chamado "ap√≥s" o Chart desenhar tudo (ideal para desenhar sobre o gr√°fico)
            const { ctx, chartArea: { width, height } } = chart;
            // Desestrutura√ß√£o: pega o contexto 2D (ctx) e as dimens√µes do "chartArea" (√°rea de desenho √∫til)
            // ctx => objeto CanvasRenderingContext2D usado para desenhar texto/formas
            // width, height => largura/altura da √°rea de desenho
            const dataset = chart.data.datasets[0]; // Acessa o primeiro dataset do gr√°fico (assumimos que o valor principal est√° aqui)
            const value = dataset.data[1]; // Pega o valor do segundo item do dataset (ex: 80 = 80%)
            // Ajuste fino de propor√ß√£o ‚Äî define tamanhos relativos de fonte com base no tamanho do gr√°fico
            const mainFontSize = Math.min(width, height) / 8; // Tamanho da fonte principal (porcentagem). Usa o menor lado para manter propor√ß√£o.
            const subFontSize = Math.min(width, height) / 18; // Tamanho da fonte do subt√≠tulo (legenda menor)
            ctx.save(); // Salva o estado atual do contexto (cores, fontes, alinhamentos) para restaurar depois
            ctx.textAlign = "center"; // Alinha o texto horizontalmente ao centro (para usar width/2)
            ctx.textBaseline = "middle"; // Alinha o texto verticalmente ao meio (para usar height/2)
            ctx.fillStyle = "#0a1911"; // Cor do texto (hex ou nome) ‚Äî define a cor usada em fillText
            // Texto principal (porcentagem)    
            ctx.font = `bold ${mainFontSize}px Arial`; // Define a fonte: peso 'bold', tamanho calculado dinamicamente e fam√≠lia 'Arial'
            ctx.fillText(value + '%', width / 2, height / 2 - subFontSize * 0.8);
            // Desenha o texto principal (ex: "80%") no centro horizontal (width/2)
            // A posi√ß√£o vertical √© ajustada para ficar um pouco acima do centro (subFontSize * 0.8) para abrir espa√ßo ao subt√≠tulo
            // Subt√≠tulo
            ctx.font = `bold ${subFontSize}px Arial`; // Fonte do subt√≠tulo (um pouco menor)
            ctx.fillText('Preenchimento atual', width / 2, height / 2 + mainFontSize * 0.5);
            // Desenha o subt√≠tulo logo abaixo do n√∫mero principal.
            // A posi√ß√£o vertical usa mainFontSize * 0.5 para garantir espa√ßamento proporcional.
            ctx.restore(); // Restaura o estado do contexto salvo por ctx.save()
            // Isso evita que altera√ß√µes de fonte/alinhamento/cor afetem outros desenhos no canvas
        }
    };
    
    // Gr√°fico de Rosca do Preenchimento Atual de uma Lixeira Recic√°vel
    /* Cria uma nova inst√¢ncia de Chart no canvas RoscaReciclavel.
    "new Chart(elemento, config)" √© a forma padr√£o de inicializar um gr√°fico com Chart.js. */
    new Chart(RoscaReciclavel, {
        type: "doughnut", // Tipo do gr√°fico: "doughnut" (rosquinha).
        data: { // Objeto que cont√©m os dados e r√≥tulos do gr√°fico
            // labels: [ // "labels" define os r√≥tulos das fatias
            //     "Vazio",
            //     "Ocupado"
            // ],
            datasets: [{ // Vetor de conjuntos de dados. Mesmo que seja apenas 1 dataset, precisa ser um vetor
                label: "", // Nome do dataset ‚Äî aparece na legenda e pode ser usado nos tooltips
                data: [100 - ultimo1, ultimo1], // Valores num√©ricos do dataset (ultimo1 = ultimo dado coletado do sensor, 100 - ultimo1 = porcentagem da lixeira vazia)
                backgroundColor: [ // Cor de cada fatia do gr√°fico
                "rgb(240, 240, 240)", // Cor da fatia de espa√ßo vazio na lixeira sempre ser√° branco
                cor1 // Cor da fatia de ocupa√ß√£o da lixeira se altera dinamicamente
                ],
                hoverOffset: 4 // Efeito de crescimento da fatia ao passar o mouse por cima
            }]
        },
        options: { // Configura√ß√µes e op√ß√µes do gr√°fico (layout, plugins, escalas, interatividade, etc.)
            responsive: true, // Faz o gr√°fico redimensionar automaticamente com o container
            cutout: "80%", // Espessura do gr√°fico de rosca, quanto maior mais fino o c√≠rculo
            plugins: { // Configura√ß√µes para plugins nativos (legend, title, tooltip, etc.) ou criados 
                legend: { 
                    position: "center",
                    labels: {
                        boxWidth: 15,
                        font: { size: 12 }
                    }
                }, // Mostra a legenda (nome do dataset)
                // title: { 
                //     display: true, 
                //     text: "Preenchimento Atual - Recicl√°vel",
                //     color: "black",
                //     font: {size: 15, weight: "bold", family: "Arial"},
                // }, // T√≠tulo do gr√°fico
                tooltip: { // Personaliza o conte√∫do do tooltip (o bal√£o que aparece ao passar o mouse)
                    callbacks: {
                        label: function(context) { // "label" recebe o contexto do ponto e retorna a string que aparecer√° no tooltip
                            // context.parsed = valor do dataset
                            return " " + context.parsed + "%";
                        }
                    }
                }
            },
        },
        plugins: [centerTextPlugin] // Plugin criado para acrescentar a porcentagem de ocupa√ß√£o da lixeira no centro do gr√°fico
    });
    
    // Gr√°fico de Rosca do Preenchimento Atual de uma Lixeira Org√¢nica
    /* Cria uma nova inst√¢ncia de Chart no canvas RoscaOrganico.
    "new Chart(elemento, config)"" √© a forma padr√£o de inicializar um gr√°fico com Chart.js */
    new Chart(RoscaOrganico, {
        type: "doughnut", // Tipo do gr√°fico: "doughnut" (rosquinha).
        data: { // Objeto que cont√©m os dados e r√≥tulos do gr√°fico
            // labels: [ // "labels" define os r√≥tulos das fatias
            //     "Vazio",
            //     "Ocupado"
            // ],
            datasets: [{ // Vetor de conjuntos de dados. Mesmo que seja apenas 1 dataset, precisa ser um vetor
                label: "", // Nome do dataset ‚Äî aparece na legenda e pode ser usado nos tooltips
                data: [100 - ultimo2, ultimo2], // Valores num√©ricos do dataset (ultimo1 = ultimo dado coletado do sensor, 100 - ultimo1 = porcentagem da lixeira vazia)
                backgroundColor: [ // Cor de cada fatia do gr√°fico
                "rgb(240, 240, 240)", // Cor da fatia de espa√ßo vazio na lixeira sempre ser√° branco
                cor2 // Cor da fatia de ocupa√ß√£o da lixeira se altera dinamicamente
                ],
                hoverOffset: 4 // Efeito de crescimento da fatia ao passar o mouse por cima
            }]
        },
        options: { // Configura√ß√µes e op√ß√µes do gr√°fico (layout, plugins, escalas, interatividade, etc.)
            responsive: true, // Faz o gr√°fico redimensionar automaticamente com o container
            cutout: "80%", // Espessura do gr√°fico de rosca, quanto maior mais fino o c√≠rculo
            plugins: { // Configura√ß√µes para plugins nativos (legend, title, tooltip, etc.) ou criados 
                legend: {
                    position: "center",
                    labels: {
                        boxWidth: 15,
                        font: { size: 12 }
                    }
                }, // Mostra a legenda (nome do dataset)
                // title: { 
                //     display: true, 
                //     text: "Preenchimento Atual - Org√¢nico",
                //     color: "black",
                //     font: {size: 15, weight: "bold", family: "Arial"},
                // }, // T√≠tulo do gr√°fico
                tooltip: { // Personaliza o conte√∫do do tooltip (o bal√£o que aparece ao passar o mouse)
                    callbacks: {
                        label: function(context) { // "label" recebe o contexto do ponto e retorna a string que aparecer√° no tooltip
                            // context.parsed = valor do dataset
                            return " " + context.parsed + "%";
                        }
                    }
                },
            },
        },
        plugins: [centerTextPlugin] // Plugin criado para acrescentar a porcentagem de ocupa√ß√£o da lixeira no centro do gr√°fico
    });

</script>

